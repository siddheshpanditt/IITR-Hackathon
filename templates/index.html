<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Monitoring Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <h1>Deployment Monitoring Dashboard</h1>
        <div class="status-card">
            <h2>Deployment Status</h2>
            <p id="deployment-status" class="status-indicator">Loading...</p>
        </div>
        <div class="status-card">
            <h2>Resource Status</h2>
            <p id="resource-status" class="status-indicator">Loading...</p>
            <p id="resource-message" class="status-message"></p>
        </div>
        <button id="fix-button" class="fix-button">Fix My Deployment</button>
        <p id="response-message" class="response-message"></p>
    </div>

    <script>
        // Function to fetch and update deployment status
        async function updateStatus() {
            try {
                const response = await fetch("/status");
                const data = await response.json();
                document.getElementById("deployment-status").textContent = data.status;
                document.getElementById("deployment-status").className = `status-indicator ${data.status.toLowerCase()}`;
                document.getElementById("resource-status").textContent = data.resource_status;
                document.getElementById("resource-status").className = `status-indicator ${data.resource_status.toLowerCase()}`;
                document.getElementById("resource-message").textContent = data.resource_message;
            } catch (error) {
                console.error("Error fetching status:", error);
            }
        }

        // Function to handle "Fix My Deployment" button click
        document.getElementById("fix-button").addEventListener("click", async () => {
            try {
                const response = await fetch("/fix", { method: "POST" });
                const data = await response.json();
                document.getElementById("response-message").textContent = data.message;
                // Refresh status after fixing
                updateStatus();
            } catch (error) {
                console.error("Error fixing deployment:", error);
            }
        });

        // Update status every 5 seconds
        setInterval(updateStatus, 5000);

        // Initial status update
        updateStatus();
    </script>
</body>
</html>